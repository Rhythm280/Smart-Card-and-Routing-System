package com.smartBusSystem.service;

import com.smartBusSystem.db.*;
import com.smartBusSystem.model.*;

import java.sql.*;

public class FareService {
    public FarePolicy getPolicy() {
        String sql = "SELECT per_km, min_fare FROM fare_policy WHERE id=1";
        try (Connection con = DB.get(); Statement st = con.createStatement(); ResultSet rs = st.executeQuery(sql)) {
            if (rs.next()) return new FarePolicy(rs.getDouble(1), rs.getDouble(2));
        } catch (SQLException e) { e.printStackTrace(); }
        return new FarePolicy(3.0, 10.0);
    }

    public double computeFare(double distanceKm) {
        FarePolicy p = getPolicy();
        return Math.max(p.getMinFare(), Math.round((p.getPerKm() * distanceKm) * 100.0)/100.0);
    }
}
